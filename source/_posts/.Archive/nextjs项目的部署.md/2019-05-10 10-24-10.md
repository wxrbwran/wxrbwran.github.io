---
title: nextjs项目的部署
date: 2019-05-10 10:11:05
tags: nextjs
---
## 常规部署
### Export静态资源
提到发布页面，就不能不提到Next提供的这个功能了，前面也减少过，但是很简单的介绍的，正好这个Demo全是静态页，没有任何数据获取操作～
Export的功能就是通过配置，将对应的pages下的路由页面导出成静态html文件。
<!--more-->

### export 配置
```js
// package.json
"scripts": {
    "dev": "NODE_ENV=development node server.ts -p 3006",
    "prod": "NODE_ENV=production node server.ts -p 3006",
    "start": "NODE_ENV=production node server.ts",
    "build": "next build",
    // 新增export命令
    "export": "yarn build && next export",
 }
 
 // next.config.js
 exportPathMap: async function (defaultPathMap) {
    return {
      '/': { page: '/' },
      '/user': { page: '/user' },
      '/user/list': { page: '/user/list' },
      '/user/detail': { page: '/user/detail' }
    }
  }
```

### serve启动
我们通过export命令，会将项目生成一个静态资源文件夹out，如图所示：
![](./next1.png)

> 其实这个就跟我们正常的SPA应用例如create-react-app生成的build文件夹很像，里面有一个index.html。同理，我们可以使用serve来进行启动～
```js
1.安装serve
yarn add serve

2.增加启动命令
"scripts": {
    ...
    // 增加
    "static": "yarn export && serve out"
  }

3.运行命令
yarn static
```
运行后控制台截图，以及访问localhost:5000/
![](./next2.png)
## 生产环境部署
> 官方的代码就是将NODE_ENV设置成production即可，就是生产环境～，这里说明一下正好有人问过，如果是windows环境，命令应该变成"prod": "set NODE_ENV=production && node server.js"
> 即： yarn build

## PM2实现高级部署上线

## now 部署

