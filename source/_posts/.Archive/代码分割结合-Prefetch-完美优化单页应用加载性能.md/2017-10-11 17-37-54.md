---
title: 代码分割结合 Prefetch 完美优化单页应用加载性能
date: 2017-10-11 17:26:46
tags: webpack
---
> 单页应用性能的最大痛点就是 bundle 体积大导致首屏时间过长。使用 webpack 的 code splitting（代码分割）功能可以将 bundle 分片，加速首屏，但之后的交互势必会受到影响,页面变得不再流畅，稍有卡顿，所以放弃了分片，但是现在发现有webpack插件解决JS文件后加载响应慢的问题，所以记了下来。

<!--more-->
先说结论：比较理想的解决方案是**code split** + **prefetch** 方式，对于~~不支持prefetch的safari浏览器~~另做**preload**处理。

### preload
**preload** 是较新的 web 标准。他可以声明式的告诉浏览器去获取某个资源，并且可以为资源设置优先级。
``` css
<link rel="preload" href="font.woff2" as="font" type="font/woff2" crossorigin>
```
preload **加载资源后并不会执行**，可以安全的预加载 JavaScript。我们一般使用 preload 来主动通知浏览器获取本页的关键资源。现在浏览器都有 Preloader，可以尽早发现大多数基于标记语言的资源，但依然存在一些隐藏在 CSS 和 JavaScript 中的资源，例如字体文件，其为首屏关键资源又隐藏在 CSS 中。这种场景适合使用 preload 进行声明，尽早进行资源加载，避免页面渲染延迟。

preload 的更多细节可参考文章 Preload: What Is It Good For?，它适合用来预加载被隐藏的首屏关键资源。preload 的兼容性并不理想，目前只有最新版的 chrome 和 safari 才支持。
